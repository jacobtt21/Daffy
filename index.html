<!DOCTYPE html>
<html>
  <head>
    <title>Daffy | Oustro</title>
    <meta charset="UTF-8" />
    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- 1️⃣ Install Magic SDK -->
    <script src="https://auth.magic.link/sdk"></script>
    <script>
      /* 2️⃣ Initialize Magic Instance */
      let magic = new Magic("pk_live_7930B08D843CFD8B");

      /* 3️⃣ Implement Render Function */
      const render = async () => {
        const isLoggedIn = await magic.user.isLoggedIn();

        /* Show login form if user is not logged in */
        let html = `
        <div class="min-h-screen bg-cover bg-center bg-local bg-no-repeat flex justify-center items-center h-screen" style="background-image: url(https://assets.teenvogue.com/photos/5c196327db720305029db3dc/master/pass/GettyImages-862457080.jpg)">
          <!-- Make sure the following div id (OTPInput) is the same in the Javascipt -->
          <form onsubmit="handleLogin(event)" autocomplete="off"">
            <div class="justify-center items-center flex p-10">
              <h1 class="text-7xl text-black">Welcome to Daffy</h1>
            </div>
            <div class="bg-white p-10 rounded flex justify-center items-center">
              <h1 class="text-black">US Phone Number: </h1>
              <!-- This is the div where the otp fields are generated by Javascript -->
              <!-- Change this name attribute to mach your form submission parameters. Make sure you update the id in the javascript code if any changes are made to the id attribute -->
              <input autocomplete="off" pattern="[0-9]*" class="w-12 h-12 bg-sky-400 border-sky-200 outline-none focus:bg-sky-200 m-2 text-center rounded focus:border-sky-200 focus:shadow-outline" maxLength = 1 name="phone1" id="yeet1" onkeyup="jump001(this, 'yeet2', 'yeet1')">
              <input autocomplete="off" pattern="[0-9]*" class="w-12 h-12 bg-sky-400 border-sky-200 outline-none focus:bg-sky-200 m-2 text-center rounded focus:border-sky-200 focus:shadow-outline" maxLength = 1 name="phone2" id="yeet2" onkeyup="jump001(this, 'yeet3', 'yeet1')">
              <input autocomplete="off" pattern="[0-9]*" class="w-12 h-12 bg-sky-400 border-sky-200 outline-none focus:bg-sky-200 m-2 text-center rounded focus:border-sky-200 focus:shadow-outline" maxLength = 1 name="phone3" id="yeet3" onkeyup="jump001(this, 'yeet4', 'yeet2')">
              <input autocomplete="off" pattern="[0-9]*" class="w-12 h-12 bg-sky-400 border-sky-200 outline-none focus:bg-sky-200 m-2 text-center rounded focus:border-sky-200 focus:shadow-outline" maxLength = 1 name="phone4" id="yeet4" onkeyup="jump001(this, 'yeet5', 'yeet3')">
              <input autocomplete="off" pattern="[0-9]*" class="w-12 h-12 bg-sky-400 border-sky-200 outline-none focus:bg-sky-200 m-2 text-center rounded focus:border-sky-200 focus:shadow-outline" maxLength = 1 name="phone5" id="yeet5" onkeyup="jump001(this, 'yeet6', 'yeet4')">
              <input autocomplete="off" pattern="[0-9]*" class="w-12 h-12 bg-sky-400 border-sky-200 outline-none focus:bg-sky-200 m-2 text-center rounded focus:border-sky-200 focus:shadow-outline" maxLength = 1 name="phone6" id="yeet6" onkeyup="jump001(this, 'yeet7', 'yeet5')">
              <input autocomplete="off" pattern="[0-9]*" class="w-12 h-12 bg-sky-400 border-sky-200 outline-none focus:bg-sky-200 m-2 text-center rounded focus:border-sky-200 focus:shadow-outline" maxLength = 1 name="phone7" id="yeet7" onkeyup="jump001(this, 'yeet8', 'yeet6')">
              <input autocomplete="off" pattern="[0-9]*" class="w-12 h-12 bg-sky-400 border-sky-200 outline-none focus:bg-sky-200 m-2 text-center rounded focus:border-sky-200 focus:shadow-outline" maxLength = 1 name="phone8" id="yeet8" onkeyup="jump001(this, 'yeet9', 'yeet7')">
              <input autocomplete="off" pattern="[0-9]*" class="w-12 h-12 bg-sky-400 border-sky-200 outline-none focus:bg-sky-200 m-2 text-center rounded focus:border-sky-200 focus:shadow-outline" maxLength = 1 name="phone9" id="yeet9" onkeyup="jump001(this, 'yeet10', 'yeet8')">
              <input autocomplete="off" pattern="[0-9]*" class="w-12 h-12 bg-sky-400 border-sky-200 outline-none focus:bg-sky-200 m-2 text-center rounded focus:border-sky-200 focus:shadow-outline" maxLength = 1 name="phone10" id="yeet10" onkeyup="jump001(this, 'yeet10', 'yeet9')">
            </div>
            <div class="justify-center items-center flex">
              <button type="submit" class="mt-10 button button-primary font-bold text-lg px-6 pt-3 pb-3  rounded bg-black text-white" id="otpSubmit">Submit</button>
            </div>
          </form>
        </div>
        `;

        if (isLoggedIn) {
          /* Get user metadata including phone */
          const userMetadata = await magic.user.getMetadata();
          html = `
            <div class="min-h-screen flex flex-col justify-center text-center">
              <h1>Boom, we got it!</h1>
              <h1>You should be getting a text soon welcoming you to Daffy!</h1>
              <button onclick="handleLogout()">Click me to add another phone number</button>
            </div>
          `;
        }

        document.getElementById("app").innerHTML = html;
      };

      /* 4️⃣ Implement Login Handler */
      const handleLogin = async (e) => {
        e.preventDefault();
        const phoneNumber1 = new FormData(e.target).get("phone1");
        const phoneNumber2 = new FormData(e.target).get("phone2");
        const phoneNumber3 = new FormData(e.target).get("phone3");
        const phoneNumber4 = new FormData(e.target).get("phone4");
        const phoneNumber5 = new FormData(e.target).get("phone5");
        const phoneNumber6 = new FormData(e.target).get("phone6");
        const phoneNumber7 = new FormData(e.target).get("phone7");
        const phoneNumber8 = new FormData(e.target).get("phone8");
        const phoneNumber9 = new FormData(e.target).get("phone9");
        const phoneNumber0 = new FormData(e.target).get("phone10");
        const phoneNumber =
          "+1" +
          phoneNumber1 +
          phoneNumber2 +
          phoneNumber3 +
          phoneNumber4 +
          phoneNumber5 +
          phoneNumber6 +
          phoneNumber7 +
          phoneNumber8 +
          phoneNumber9 +
          phoneNumber0;

        if (phoneNumber) {
          /* One-liner login 🤯 */
          await magic.auth.loginWithSMS({ phoneNumber });
          const formData = new FormData();
          formData.append("number", phoneNumber);
          fetch("https://getform.io/f/d3f0e2d1-4a74-4944-be87-76079c888194", {
            method: "POST",
            body: formData
            })
          render();
        }
      };

      /* 5️⃣ Implement Logout Handler */
      const handleLogout = async () => {
        await magic.user.logout();
        render();
      };

      function jump001(field, Rmove, Lmove) {
          if (event.key === "Backspace") {
            if (field.value !== '') {
              field.value = '';
            }
            else {
              document.getElementById(Lmove).focus();
            }
          }
          else if (event.key !== "ArrowLeft" && event.key !== "ArrowRight") {
            if (field.value === '') {
              document.getElementById(Rmove).focus();
            }
            else {
              field.value = event.key;
              document.getElementById(Rmove).focus();
            }
          }
      }
    </script>
  </head>
  <body onload="render()">
    <div id="app">
      Loading...
    </div>
  </body>
</html>
